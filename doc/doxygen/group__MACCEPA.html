<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Hardware Toolbox: MACCEPA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Hardware Toolbox
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">MACCEPA</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:libmaccepa_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libmaccepa_8c.html">libmaccepa.c</a></td></tr>
<tr class="memdesc:libmaccepa_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Library of functions for calculating dynamics properties of the MACCEPA. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:mex__libmaccepa_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mex__libmaccepa_8c.html">mex_libmaccepa.c</a></td></tr>
<tr class="memdesc:mex__libmaccepa_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">MEX gateway to MACCEPA dynamics library (libmaccepa). <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:libmaccepa_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libmaccepa_8h.html">libmaccepa.h</a></td></tr>
<tr class="memdesc:libmaccepa_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Library of functions for calculating dynamics properties of the MACCEPA. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:test__maccepa_8py"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test__maccepa_8py.html">test_maccepa.py</a></td></tr>
<tr class="memdesc:test__maccepa_8py"><td class="mdescLeft">&#160;</td><td class="mdescRight">Script for testing control of the MACCEPA. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="anchor" id="maccepa_info"></a>
Information about the 2-link MACCEPA implementation</h1>
<div class="image">
<img src="maccepa_hardware.png" alt="maccepa_hardware.png"/>
<div class="caption">
MACCEPA</div></div>
 <h2><a class="anchor" id="dynamics"></a>
Dynamics</h2>
<p>The MACCEPA dynamics library contains functions for calculating dynamics properties of the robot based on an analytical model of the robot. The geometry of this model is shown below: </p>
<div class="image">
<img src="maccepa_model.png" alt="maccepa_model.png"/>
</div>
<p>The dynamics equations are as follows.</p>
<ul>
<li>Joint torque: <img class="formulaInl" alt="$\tau(q,\mathbf{u}) = \kappa BC\sin(u_1+q)\left(1+\frac{ru_2-(C-B)}{\sqrt{B^2 + C^2 - 2BC\cos(u_1+q)}}\right)$" src="form_32.png"/></li>
</ul>
<p>where <img class="formulaInl" alt="$B$" src="form_33.png"/>, <img class="formulaInl" alt="$C$" src="form_34.png"/> are shown in the diagram above, <img class="formulaInl" alt="$r$" src="form_35.png"/> is the radius of the drum attached to the pretensioning servo, and <img class="formulaInl" alt="$\kappa$" src="form_5.png"/> is the spring constant of the spring.</p>
<ul>
<li>Joint stiffness: <img class="formulaInl" alt="$\begin{array}{rl}k(\mathbf{x},\mathbf{u}) =&amp;\kappa BC\cos(u_1+q)\left( 1 + \frac{ru_2 - (C-B)}{\sqrt{B^2+C^2-2BC\cos(u_1+q)}} \right)\\ &amp;-\kappa BC\sin(u_1+q)\frac{(ru_2-(C-B))BC\sin(u_1+q)}{(B^2 + C^2 - 2BC\cos(u_1+q))^{\frac{3}{2}}}\end{array}$" src="form_36.png"/></li>
</ul>
<ul>
<li>Equilibrium Position: <img class="formulaInl" alt="$q_{0}=u_1$" src="form_37.png"/></li>
</ul>
<dl class="section see"><dt>See Also</dt><dd>The maxima script doc/maxima/maccepa.mac for derivations.</dd></dl>
<p>The dynamics parameters (inertia, spring constants, lengths) are measured by hand or estimated with a system identification. These are defined in sketchbook/maccepa/defines.h</p>
<h2><a class="anchor" id="sys_id"></a>
System Identification</h2>
<p>All estimated parameters from system identification are stored in sketchbook/maccepa/defines.h</p>
<p>The process of system identifiaction is data driven, based on least squares fitting, and (mostly) automated through matlab scripts. The top level script for this is <a href="../m2html/MACCEPA/identify_maccepa.html">identify_maccepa.m</a>. This is an interactive script, and will print out instructions as it runs (see the matlab documentation for details). It basically calls successive system-id scripts for fitting different parameters in sequence, starting with the servo pots, onto the joint sensors, then onto the dynamics parameters such as inertia. As there is interdependency in the parameters (i.e., the estimation of some parameters depends on - and is bootstrapped from - estimates of other parameters), the script requires that you update these in sketchbook/maccepa/defines.h at each stage of the identification. After each stage, the script recompiles the underlying c code to incorporate the new estimates. Note that after system identifcation is complete, you can re-run the identification script to check that the parameters have been properly updated (e.g., many of the sensor 'scaling' parameters will be approximately 1, and the 'offset' parameters approximately 0).</p>
<h2><a class="anchor" id="system_characterisation"></a>
System Characterisation</h2>
<p>Based on this model of the dynamics, the below figures give some characterisation of the system dynamics.</p>
<div class="image">
<img src="eqpos_vs_u_maccepa.png" alt="eqpos_vs_u_maccepa.png"/>
<div class="caption">
Equlibrium position vs. motor positions (evaluated at q=0, dq/dt=0)</div></div>
<div class="image">
<img src="stiff_vs_u_maccepa.png" alt="stiff_vs_u_maccepa.png"/>
<div class="caption">
Stiffness vs. motor positions (evaluated at q=0, dq/dt=0)</div></div>
 <h2><a class="anchor" id="figures"></a>
Useful facts and figures:</h2>
<ul>
<li>The maximum range of the joint is <img class="formulaInl" alt="$-\frac{\pi}{2}\le q \le\frac{\pi}{2}$" src="form_38.png"/> radiens.</li>
</ul>
<ul>
<li>The maximum range of commands to servo 0 (equilibrium position servo) is <img class="formulaInl" alt="$-\frac{\pi}{2}\le u_1\le\frac{\pi}{2}$" src="form_39.png"/> radiens.</li>
</ul>
<ul>
<li>The maximum range of commands to servo 1 (stiffness servo) is <img class="formulaInl" alt="$0\le u_2\le\pi$" src="form_10.png"/> radiens.</li>
</ul>
<ul>
<li>The maximum stiffness range is <img class="formulaInl" alt="$-0.657894\le k\le 0.415422$" src="form_40.png"/> Nm/rad. <dl class="section note"><dt>Note</dt><dd>This stiffness range is based on the gradient of the torque function evaluated away from the equilibrium. For this reason, negative values are possible, however this is not neccessarily an indicator of instability! (For this, consider the sign of the torque at a given point). This range was estimated by sampling the gradient of the torque function, over the full range of the joint angle and servo positions.</dd></dl>
</li>
<li>The maximum range of equilibrium positions is <img class="formulaInl" alt="$-\frac{\pi}{2}\le q_0\le\frac{\pi}{2}$" src="form_41.png"/> radiens.</li>
</ul>
<h2><a class="anchor" id="components"></a>
Components</h2>
<p>Datasheets for the componenets used can be found below. </p>
<ul>
<li><a href="../datasheets/doc8161.pdf">Microcontroller (Atmel 328)</a> </li>
<li><a href="../datasheets/HSR5990TG.pdf">Servos (Hitec HSR-5990TG)</a> </li>
<li><a href="../datasheets/MLX90316.pdf">Joint angle sensor (MLX90316 Rotary Position Sensor)</a> </li>
<li><a href="../datasheets/Z-081K-01I-datasheet.pdf">Spring</a> </li>
<li><a href="../datasheets/A-max-22-110117_10_EN_097.pdf">Damper motor (Maxon A-max 22/110125)</a> and <a href="../datasheets/GP-22-L-232763_10_EN_221.pdf">gearhead (Maxon GP 22 L/232768)</a> </li>
<li><a href="../datasheets/LM358.pdf">Op-Amp for current sensing circuit</a> </li>
<li><a href="../datasheets/L293D.pdf">H-bridge (for controlling the electro-magnet)</a></li>
</ul>
<h2><a class="anchor" id="current_sensor"></a>
Current Sensing Circuit</h2>
<p>Current sensing circuit is show below. </p>
<div class="image">
<img src="current_sensor.png" alt="current_sensor.png"/>
</div>
<p> Current can be calculated as <img class="formulaInl" alt="$ V_{out} = I R_s ( 1 + R_2/R_2) \to I= \frac{V_{out}}{R_s(1+R_2/R_2)}$" src="form_42.png"/>. </p>
<dl class="section see"><dt>See Also</dt><dd>Forum discussions <a href="http://letsmakerobots.com/node/10960">here</a> and <a href="http://letsmakerobots.com/node/18517">here</a></dd></dl>
<h2><a class="anchor" id="references"></a>
References</h2>
<p>The MACCEPA design was originally proposed in:</p>
<ul>
<li>Ham, R. V.; Vanderborght, B.; Damme, M. V.; Verrelst, B. &amp; Lefeber, D. MACCEPA, the mechanically adjustable compliance and controllable equilibrium position actuator: Design and implementation in a biped robot Robotics and Autonomous Systems, 2007, 55, 761-768 </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 28 2016 17:19:58 for Hardware Toolbox by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
